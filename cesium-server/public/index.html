<!DOCTYPE html>
<html>
<head>
    <title>Cesium Demo</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.82/Build/Cesium/Cesium.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.82/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
</head>
<body>
    <div id="cesiumContainer" style="width: 100%; height: 100vh;"></div>
    <script>
        Cesium.Ion.defaultAccessToken = '<your-access-token-here>';

        // Initialize the Cesium Viewer in the div with the ID 'cesiumContainer'
        const viewer = new Cesium.Viewer("cesiumContainer");
        viewer.clock.shouldAnimate = true; // Enable clock animation


        // Initialize socket.io client
        const socket = io('http://localhost:4000'); // Adjust the URL as needed
         
        const startLatitude = 37.80089545694181;
        const startLongitude = -122.43190204818632;

        // Array to store the GPS coordinates starting with the initial start point
        let pathCoordinates = [startLongitude, startLatitude];

        // Add a dynamic polyline to the scene
        const isConstant = false; // dynamic
        const redLine = viewer.entities.add({
            polyline: {
                // Dynamically update positions
                positions: new Cesium.CallbackProperty(function (time, result) {
                    return Cesium.Cartesian3.fromDegreesArray(
                      pathCoordinates,
                      Cesium.Ellipsoid.WGS84,
                      result
                  );
                }, isConstant),
                width: 5,
                material: Cesium.Color.RED,
            },
        });

        // Listen for GPS position updates from the server
        socket.on('gpsPosition', function(data) {
            if(data && data.latitude && data.longitude) {

                // Append the new position to the pathCoordinates array
                pathCoordinates.push(data.longitude, data.latitude);

                console.log(`Received GPS position: Latitude ${data.latitude}, Longitude ${data.longitude}`);
            }
        });

        // Focus the viewer on the polyline
        viewer.zoomTo(viewer.entities);
  </script>
</body>
</html>
